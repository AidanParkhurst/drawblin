import{i as C,r as E,e as v,b as B}from"./auth-XtUnfzLK.js";/* empty css              *//* empty css             */import{f as L}from"./entitlements-BCQvOwy8.js";function e(a,l={},t=[]){const c=document.createElement(a);for(const[i,s]of Object.entries(l))i==="class"?c.className=s:i==="text"?c.textContent=s:i.startsWith("on")&&typeof s=="function"?c.addEventListener(i.slice(2),s):c.setAttribute(i,s);for(const i of[].concat(t))i&&c.appendChild(typeof i=="string"?document.createTextNode(i):i);return c}async function g(){const a=document.getElementById("account-content");if(!a)return;if(a.innerHTML="",!C()){a.appendChild(e("div",{class:"account-card center"},[e("div",{class:"field-value",text:"Auth not configured."})]));return}await E();const l=B();if(!l){const n=e("button",{class:"btn-primary",text:"Sign in to view account details"});n.addEventListener("click",()=>{window.location.assign("./login")});const o=e("div",{class:"account-card center"},[n]);a.appendChild(o);return}const t=await L(!0)||{};let c="";try{const n=v();if(n){const{data:o,error:d}=await n.from("profiles").select("name").eq("id",l.id).maybeSingle();d||(c=(o?.name||"").trim())}}catch{}const i=e("section",{class:"identity-block"},[e("div",{class:"identity-grid"},[e("div",{},[e("div",{class:"field-label",text:"Goblin Name"}),e("div",{class:"field-value",text:c||"(not set)"})]),e("div",{},[e("div",{class:"field-label",text:"Email"}),e("div",{class:"field-value",text:l.email||"(unknown)"})])])]);let s="Not a premium member",w="";t?.has_premium&&(s="Premium member",w="Renews automatically");const m=t?.has_premium?e("button",{class:"btn-outline",text:"Cancel membership"}):null;m&&m.addEventListener("click",()=>{alert("To cancel, use the link in your checkout email (from Stripe). Or email us at: support@drawbl.in")});const y=e("div",{class:"account-card account-card--row account-row"},[e("div",{},[e("div",{class:"account-row-title",text:s}),e("div",{class:"account-row-sub",text:w})]),m].filter(Boolean)),u=[],p=(n,o)=>{const d=e("div",{class:"account-card account-card--row account-row"},[e("div",{},[e("div",{class:"account-row-title",text:n}),e("div",{class:"account-row-sub",text:o?`Purchased on ${o}`:"Included with Premium"})])]);u.push(d)},x=!!(t?.pet_pack||t?.win_bling_pack||t?.more_goblins_pack);let r={pet_pack:null,win_bling_pack:null,more_goblins_pack:null};if(x)try{const n=v();if(n){const{data:o,error:d}=await n.from("entitlement_events").select("entitlement, created_at").eq("user_id",l.id).eq("kind","grant").in("entitlement",["pet_pack","win_bling_pack","more_goblins_pack"]);if(!d&&Array.isArray(o))for(const _ of o){const b=_.entitlement,k=r[b],h=_.created_at?new Date(_.created_at):null;h&&(!k||h<k)&&(r[b]=h)}}}catch{}const f=n=>n instanceof Date?n.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):null;(t?.pet_pack||t?.has_premium)&&p("Companion Critter Collection",t?.pet_pack?f(r.pet_pack):null),(t?.win_bling_pack||t?.has_premium)&&p("Big Win Bling Bundle",t?.win_bling_pack?f(r.win_bling_pack):null),(t?.more_goblins_pack||t?.has_premium)&&p("More Goblins",t?.more_goblins_pack?f(r.more_goblins_pack):null),u.length||u.push(e("div",{class:"muted",text:"No packs purchased"})),a.appendChild(i),a.appendChild(e("h2",{class:"account-h2",text:"Membership"})),a.appendChild(y),a.appendChild(e("h2",{class:"account-h2",text:"Packs"}));for(const n of u)a.appendChild(n)}window.addEventListener("DOMContentLoaded",g);window.addEventListener("auth:user-changed",g);
